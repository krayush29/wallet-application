<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="1" author="krayush29">
        <sql>
            CREATE TABLE wallets
            (
                id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                balance       DOUBLE PRECISION NOT NULL,
                currency_type VARCHAR(255)
                    CONSTRAINT wallets_currency_type_check
                        CHECK ((currency_type)::text = ANY ((ARRAY ['USD':: character varying, 'INR':: character varying])::text[])
            )
                );
        </sql>
    </changeSet>

    <changeSet id="2" author="krayush29">
        <sql>
            create table users
            (
                user_id   bigint generated by default as identity
                    primary key,
                password  varchar(255) not null,
                username  varchar(255) not null
                    constraint ukr43af9ap4edm43mmtq01oddj6
                        unique,
                wallet_id bigint       not null
                    constraint uk1vggin5xlv1ptduwmtp1rm16
                        unique
                    constraint fkcf6cgic6n7ek155uj81npsbcm
                        references wallets
            );
        </sql>
    </changeSet>

    <changeSet id="3" author="krayush29">
        <sql>
            create table transactions
            (
                transaction_id bigint generated by default as identity primary key,
                amount         double precision not null,
                message        varchar(255),
                timestamp      timestamp(6)     not null,
                type           varchar(255)
                    constraint transactions_type_check
                        check ((type)::text = ANY
                    ((ARRAY ['DEPOSIT':: character varying, 'WITHDRAWAL':: character varying, 'TRANSFER':: character varying])::text[])
            )
                );
        </sql>
    </changeSet>

    <changeSet id="4" author="krayush29">
        <sql>
            create table self_transactions
            (
                transaction_id bigint not null primary key
                    constraint fkh409yah5hk7glm6dqofjeky2
                        references transactions,
                user_id        bigint not null
                    constraint fkr3xwphcepfi8em9cxjsr8fymw
                        references users
            );
        </sql>
    </changeSet>

    <changeSet id="5" author="krayush29">
        <sql>
            create table transfer_transactions
            (
                transaction_id bigint not null primary key
                    constraint fkqkx3k0fker00cyjit41qagdm1
                        references transactions,
                from_user_id   bigint not null
                    constraint fkok4cb1dfb4voqvu1hmlfylp8n
                        references users,
                to_user_id     bigint not null
                    constraint fkluqxk3skkjhvm8qq921m1w283
                        references users
            );
        </sql>
    </changeSet>
</databaseChangeLog>